
    <%- include('menu.html') %>

    <div class="container mt-4">
      <div class="d-flex justify-content-between align-items-center">
        <a href="/" class="btn btn-sm btn-outline-secondary">← Zpět na recepty</a>
        <% if (user && user.id === recipe.userId) { %>
          <button type="button" class="btn btn-warning" onclick="toggleEdit()">
            Upravit recept
          </button>
        <% } %>
      </div>

      <hr />


      <div id="recipe-view" style="display: block;">
        <%- include('_recipe.html', { recipe, user }) %>
      </div>

      <% if (user && user.id === recipe.userId) { %>
        <div id="edit-form" style="display: none;">
          <div class="card shadow-sm">
            <div class="card-header">
              <h5 class="mb-0">Úprava receptu</h5>
            </div>
            <div class="card-body">
              <form action="/recipes/<%= recipe.id %>" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                  <label for="title" class="form-label">Název receptu</label>
                  <input type="text" name="title" id="title" class="form-control" value="<%= recipe.title %>" required />
                </div>

                <div class="mb-3">
                  <label class="form-label">Ingredience</label>
                  <div id="ingredients-list">
                    <% recipe.ingredients.split(",").forEach((ing, index) => { %>
                      <div class="d-flex mb-2">
                        <input type="text" name="ingredients[]" class="form-control me-2" value="<%= ing.trim() %>" required />
                        <% if (index === 0) { %>
                          <button type="button" class="btn btn-outline-secondary" onclick="addIngredient()">+</button>
                        <% } else { %>
                          <button type="button" class="btn btn-outline-danger" onclick="this.parentNode.remove()">−</button>
                        <% } %>
                      </div>
                    <% }) %>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="category" class="form-label">Kategorie</label>
                  <select name="category" id="category" class="form-select" required>
                    <option value="">-- Vyber kategorii --</option>
                    <option value="Dezert" <%= recipe.category === "Dezert" ? "selected" : "" %>>Dezert</option>
                    <option value="Hlavní jídlo" <%= recipe.category === "Hlavní jídlo" ? "selected" : "" %>>Hlavní jídlo</option>
                    <option value="Snídaně" <%= recipe.category === "Snídaně" ? "selected" : "" %>>Snídaně</option>
                    <option value="Svačina" <%= recipe.category === "Svačina" ? "selected" : "" %>>Svačina</option>
                  </select>
                </div>

                <div class="mb-3">
                  <label for="steps" class="form-label">Postup</label>
                  <textarea name="steps" id="steps" rows="5" class="form-control" required><%= recipe.steps %></textarea>
                </div>

                <div class="mb-3">
                  <label for="image" class="form-label">Obrázek receptu</label>
                  <input type="file" name="image" id="image" class="form-control" accept="image/*" />
                  <% if (recipe.imagePath) { %>
                    <img src="/uploads/<%= recipe.imagePath %>" class="img-fluid mt-2" />
                  <% } %>
                </div>

                <div class="d-flex">
                  <button type="submit" class="btn btn-primary"> Uložit</button>
                  <a href="/recipes/<%= recipe.id %>/remove" class="btn btn-danger ms-2"> Odstranit</a>
                </div>
              </form>
            </div>
          </div>
        </div>
      <% } %>
    </div>
  
    <script>
      const ws = new WebSocket("ws://localhost:3000/ws");
      ws.addEventListener("message", (evt) => {
        const { type, id, html } = JSON.parse(evt.data);
        if (type === "recipe" && id === <%= recipe.id %>) {
          document.getElementById("recipe-view").innerHTML = html;
        } else if (type === "recipeDeleted" && id === <%= recipe.id %>) {
          window.location.replace("/");
        }
      });

      function toggleEdit() {
        const edit = document.getElementById("edit-form");
        const view = document.getElementById("recipe-view");
        const isVisible = edit.style.display === "block";
        edit.style.display = isVisible ? "none" : "block";
        view.style.display = isVisible ? "block" : "none";
      }

      function addIngredient() {
        const container = document.getElementById("ingredients-list");
        const div = document.createElement("div");
        div.className = "d-flex mb-2";
        div.innerHTML = `
          <input type="text" name="ingredients[]" class="form-control me-2" placeholder="Další ingredience" required />
          <button type="button" class="btn btn-outline-danger" onclick="this.parentNode.remove()">−</button>
        `;
        container.appendChild(div);
      }
    </script>
  </body>
</html>
